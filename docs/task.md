## `llm-agentchat` プラグイン 実装計画

### 1. プロジェクト基盤とセットアップ

* [x] 1.1. `llm-agentchat` プラグインのディレクトリ構造を初期化
* [x] 1.2. `setup.py` と `requirements.txt` を作成し、必要な依存関係（FastAPI/Flask, websockets, `simonw/llm`など）を定義
* [x] 1.3. `llm_agentchat/__init__.py` にCLIコマンドのエントリポイント (`agentchat-server`, `agentchat-client`) を定義
* *関連要件: 全体的な基盤*

### 2. サーバーサイド（`agentchat-server`）の実装

* [x] 2.1. Webサーバーアプリケーション（FastAPIまたはFlask）の基本構造を`llm_agentchat/server/app.py`に作成
* [x] 2.2. SQLiteデータベースモジュール（`llm_agentchat/server/db.py`）を実装
    * [x] 2.2.1. `messages`テーブルのスキーマ定義と初期化ロジック
    * [x] 2.2.2. メッセージの保存、取得、削除のCRUD操作
* [x] 2.3. HTTP APIエンドポイントを実装
    * [x] 2.3.1. `GET /api/messages?room=<room_name>` (過去メッセージ取得)
    * [x] 2.3.2. `POST /api/message` (メッセージ投稿)
    * [x] 2.3.3. `GET /api/agents?room=<room_name>` (参加エージェントリスト取得)
* [x] 2.4. WebSocket APIエンドポイント (`/ws?room=<room_name>`) を実装
    * [x] 2.4.1. クライアント接続・切断ハンドリング
    * [x] 2.4.2. メッセージのリアルタイムブロードキャスト機能
* [x] 2.5. 静的ファイル（Web UI）の配信設定 (`llm_agentchat/server/static/`)
* [x] 2.6. サーバー起動オプション (`--port`, `--host`, `--storage`, `--debug`, `--no-browser`) の実装
* *関連要件: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1, 3.2, 4.2, 4.3, 6.1, 6.2, 6.3*

### 3. クライアントサイド（`agentchat-client`）のエージェントコアロジック実装

* [x] 3.1. `llm_agentchat/client/agent.py` にエージェントの基本クラスを定義
* [x] 3.2. `llm_agentchat/client/websocket_client.py` にWebSocketクライアント接続ロジックを実装
* [x] 3.3. エージェント定義ファイル（`agents.yml`）の読み込みとパースロジックを実装
* [x] 3.4. 受信メッセージの処理とLLMへのプロンプト生成ロジックを実装
* [x] 3.5. `simonw/llm` のLLMモデル呼び出し機能の統合
* [x] 3.6. LLMからの応答をサーバーに送信するロジック
* [x] 3.7. 会話履歴の管理（`chat_history_limit`の適用）
* [x] 3.8. クライアント起動オプション (`--server-url`, `--agents`, `--debug`) の実装
* [x] 3.9. モデル固有オプションの`agents.yml`からの読み込みと適用
* *関連要件: 2.1, 2.2, 2.3, 2.4, 2.5, 4.1, 4.2, 5.1, 5.2, 5.3, 5.4, 7.1, 7.2, 7.3, 7.4*

### 4. Web UI（フロントエンド）の実装

* [x] 4.1. `llm_agentchat/server/static/index.html` に基本HTML構造を作成し、Tailwind CSSを導入
* [x] 4.2. `llm_agentchat/server/static/script.js` にJavaScriptロジックを実装
    * [x] 4.2.1. WebSocketへの接続とリアルタイムメッセージ受信処理
    * [x] 4.2.2. 受信メッセージのDOMへの追加とスクロール制御
    * [x] 4.2.3. HTTP API (`/api/messages`) を介した過去メッセージの取得と表示
    * [x] 4.2.4. メッセージ入力フォームと送信ボタンの機能実装
    * [x] 4.2.5. 参加エージェントリストの表示機能
* [x] 4.3. レスポンシブデザインの基本対応（CSS）
* *関連要件: 3.1, 3.2, 3.3, 4.1, 4.2, 4.3, 4.4*

### 5. エージェント定義と共通設定

* [x] 5.1. `agents.yml.example` ファイルを作成し、サンプルエージェントを定義
* [x] 5.2. `common_settings` (chat_history_limit, response_delay_ms) の実装と適用
* *関連要件: 5.1, 5.2, 5.3, 5.4*

### 6. エラーハンドリングの実装

* [x] 6.1. サーバーサイドのエラーハンドリング（ポート競合、DB接続、APIリクエストエラー、内部エラー）
* [x] 6.2. クライアントサイドのエラーハンドリング（サーバー接続失敗、LLM APIエラー、ツール実行エラー、エージェント設定エラー）
* [x] 6.3. Web UIのエラーハンドリング（WebSocket接続切断、API通信エラー、表示エラー）
* *関連要件: 全てのエラー関連要件*

### 7. パフォーマンス考慮事項の実装

* [x] 7.1. サーバーサイドのWebSocketメッセージブロードキャストの効率化
* [x] 7.2. データベースのインデックス適用とクエリ最適化
* [x] 7.3. エージェントのLLM呼び出しにおける非同期処理 (`asyncio`) の適用
* [x] 7.4. LLM APIのレートリミットに対するリトライ戦略（指数バックオフなど）
* *関連要件: 全てのパフォーマンス関連要件*

### 8. テストの実装

* [x] 8.1. サーバーロジックの単体テスト
* [x] 8.2. クライアント（エージェント）ロジックの単体テスト
* [x] 8.3. データベース操作の単体テスト
* [x] 8.4. サーバー-クライアント間の統合テスト
* [x] 8.5. LLM連携の統合テスト（モックまたは実際のAPI）
* [x] 8.6. Web UIとサーバーの連携テスト（E2Eテストの主要フロー）
* *関連要件: 全てのテスト関連要件*

### 9. 最終統合とポリッシュ

* [x] 9.1. 全コンポーネントの統合と動作確認
* [x] 9.2. UI/UXの最終調整と視覚的なポリッシュ
* [x] 9.3. ドキュメント（README.md）の整備と使用方法の明確化
* [x] 9.4. パフォーマンスの最終確認と最適化
* *関連要件: 全要件の最終検証*
